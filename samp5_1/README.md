# Model/View模型视图结构

## 1.基本原理
MVC模型视图控制器是一种设计模式，由三种对象组成。模型是应用程序对象，视图是其屏幕显示，控制器定义了用户界面对用户输入的反应方式。 在MVC之前，用户界面设计往往会将这些对象整合在一起。 MVC使它们解耦以增加灵活性和重用性。  
MVC在Qt中表现为MVD模型/视图/代理结构，三者之间通过信号和槽通信，MVD将界面组件与所编辑的数据分离开来，又通过数据源的方式连接起来，各部分功能如下：

![Model/View基本结构](https://github.com/samuel-24276/Qt5.9-Code/tree/master/samp5_1/img/Model、View.png 'Model/View基本结构')

- 1.数据(Data):是实际的数据，如数据库的一个数据表或SQL查询结果，内存中的一个StringList，或磁盘文件结构等。
- 2.**模型或数据模型(Model)与实际数据通信，并为视图组件提供数据接口**。它从原始数据提取需要的内容，用于视图组件进行显示和编辑。
- 3.视图或视图组件(View)是屏幕上的界面组件，**视图从数据模型获得每个数据项的模型索引(model index)，通过模型索引获得数据，然后为界面组件提供显示数据**。Qt提供一些现成的数据视图组件，如QListView、QTreeView和QTableView等。

## 2.Model数据模型

所有的基于项数据(item data)的数据模型(Model)都是基于`QAbstractItemModel`类的,**这个类定义了视图组件和代理存取数据的接口**。数据无需存储在数据模型里，数据可以是其他类、文件、数据库、或任何数据源。

![Qt中模型类的层次结构](https://github.com/samuel-24276/Qt5.9-Code/tree/master/samp5_1/img/Qt_Model_Structure.jpg 'Qt中模型类的层次结构')

Qt中提供了以下几个数据模型类：

| Model类 | 用途 |
| :---: | :---: |
| QStringListModel | 用于处理字符串列表数据的数据模型类 |
| QStandardltemModel | 标准的基于项数据的数据模型类，每个项数据可以是任何数据类型 |
| QFileSy stemModel | 计算机上文件系统的数据模型类 |
| QSortFilterProxyModel | 与其他数据模型结合，提供排序和过滤功能的数据模型类 |
| QSqlQueryModel | 用于数据库SQL查询结果的数据模型类 |
| QSqlTableModel | 用于数据库的一个数据表的数据模型类 |
| QSqlRelationalTableModel | 用于关系型数据表的数据模型类 |

### 2.1.模型索引

为了保证数据的表示与数据存取方式隔离，数据模型中引入了模型索引(model index)的概念。通过数据模型存取的每个数据都有一个模型索引，视图组件和代理都通过模型索引来获取数据。  
QModelIndex表示模型索引的类。模型索引提供数据存取的一个临时指针，用于通过数据模型提取或修改数据。因为模型内部组织数据的结构随时可能改变，所以索引是临时的。

### 2.2.行号和列号

数据模型基本形式是用行和列定义的表格数据，但这不意味着底层数据是用二维数组存储的，使用行列只是为了组件交互方便。  
要获得一个模型索引，需要三个参数：行号、列号、父项的模型索引。对于列表和表格模式的数据模型，顶层节点总是用QModelIndex()表示。

### 2.3.项的角色

role是Qt::ItemDataRole枚举类型，有多种取值，项的标准角色是Qt::DisplayRole()。
- 1.`Qt::DisplayRole`角色： 在视图组件中显示字符串
- 2.`Qt::ToolTip`角色： 鼠标提示消息
- 3.`Qt::UserRole`角色： 自定义数据
>**为一个项的不同角色定义数据，可以告知视图组件和代理组件如何显示数据**。

## 3.View视图组件

显示数据模型的数据的界面组件，Qt提供的主要视图组件如下：
- 1.QListView: 用于显示单列的列表数据，适用于一维数据的操作
- 2.QTreeView: 用于显示树状结构数据，适用于树状结构数据的操作
- 3.QTableView: 用于显示表格状数据，适用于二维表格型数据的操作

**视图组件在显示数据时，只需调用视图类的setModel()函数，为视图组件设置一个数据模型就可以实现视图组件与数据模型之间的关联，在视图组件上的修改将自动保存到关联的数据模型里，一个数据模型可以同时在多个视图组件里显示数据**。  
第四章介绍了QListWidegt、QTreeWidget、QTableWidget三个可用于数据编辑的组件，称为便利类，它们分别是三个视图类的子类。  
**视图组件类的数据采用单独的数据模型，视图组件不存储数据。便利类则为组件的每个节点或单元格创建一个项(item)，用项存储数据、格式设置等**。所以，便利类没有数据模型，它实际上是用项的方式集成了数据模型的功能，这样就将界面与数据绑定了。所以，便利类缺乏对大型数据源进行灵活处理的能力，适用于小型数据的显示和编辑。

## 4.Delegate代理

代理就是在视图组件上为编辑数据项提供编辑器，负责从数据模型获取相应的数据，然后显示在编辑器里，修改数据后，又将其保存到数据模型中。  
QAbstractItemDelegate是所有代理类的基类，作为抽象类，它不能直接使用。它的一个子类QStyledItemDelegate，是Qt的视图组件缺省使用的代理类。
